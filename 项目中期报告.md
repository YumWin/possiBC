# 项目中期报告

## 项目背景:

​        在现在的学习环境中，有着非常多的小组合作项目，各位程度员也有着寻找编程伙伴的需要，我们的项目适用于学生在学校或院系中系统推荐适合与自己合作学习的编程cp，以便在完成各类型的代码题目的过程中取长补短，共同进步。我们的项目仅通过分析本院系学生的作业情况组配在本院系内的编程cp，这种研究方法也可以拓展到工作中，通过分析员工以往的项目完成情况，按照合适的组配方式组成工作小组，以高效地合作完成新的工作项目。

## 项目目标

​	    我们的目标应该是建立一个在线oj或者校内在线oj的刷题系统中的一个子刷题伙伴推荐系统，可以借鉴moba游戏中的隐藏分rank系统，每个人刷新题后会有个人能力数据更新，同时匹配系统会更新更符合的伙伴，（可以在线交流，例如如果长期都有同一个人为预期伙伴可以结交成长期伙伴，校内则更加方便交流。）同时也可以通过不同的按钮->用户预期匹配方式：比如说喜欢旗鼓相当的伙伴或者互补型伙伴从而得到不同的匹配结果。此外，每个人也可以看自己的能力分布水平，可以看到图形化的信息展示，类似于moba游戏的个人战力系统。

## 数据预处理

### 数据爬取和初步处理

**1.处理过程：**

###### 数据爬取阶段：

构建一个能从网上爬取资源的函数，调用six.moves包内部的urllib实现url爬取、os包实现系统路径访问并在urllib.parse包内引入quote实现不同编码之间的转换，通过输入url列表和保存路径，将下载的文件保存到指定路径，并实现下载过程0%到100%的可视化。打开数据json文件，遍历所有题目的url并进行下载。

###### 代码整合阶段：

经组内商议，结合实际需要与程式化设计思想确定了目标保存文件内部：userId->caseType->caseId，在caseId下存放每道题爬取压缩文件的格式，便于后期解压和代码取用。

###### 数据解压阶段：

多次运用zipfile包下的extractall方法对文件夹下文件进行递归解压，将每道题的例题和每次的提交记录在创建对应文件夹后均解压在对应文件夹名的约定文件夹下，便于后期进行统一批处理和数据操作。

**2.处理结果：**

实现了最基础层次数据的获取、解压和序列化，为后期处理原始数据得到初步拟合数据、深度处理得到个人数据并最终运用算法进行组配奠定基础。

### 运行并获得原始数据

**原始数据为每道题的粒度**

**每题的评价指标首先分为算法构建能力，debug能力和第一次构建能力**

**算法构建能力评价需要的原始数据为：代码行数，时间复杂度，空间复杂度**

**debug能力需要的原始数据为：提交次数，得分涨幅，提交时间**

**第一次构建能力需要的原始数据为：第一次提交时间，第一次提交得分，第一次提交行数**  

#### 算法构建能力处理原理阐述：

需要的原始材料为该学生该道题的最后一次提交代码：因为最后一次的代码提交为学生算法构建最成熟的，也是学生对该题的最终展现形式。能够充分的体现学生算法能力和代码构建的水平。并且python具有简洁性和易用性，因此代码行数一定程度上可以也可以体现学生的构建能力和算法水平，时间复杂度和空间复杂度是传统和科学的评判学生的算法水平和构建水平的指标，分别由程序的运行时间和占用内存大小来具现化

#### 处理过程及结果：

##### 第一阶段：原数材料准备

代码文件通过数据爬取，并另存为本地文件等待处理。储存的路径为home/学生代号/题目类别/题目号/平台提供的题交信息：因为只取最后一次因此只有一个，包含学生提交代码，测试用例等

##### 第二阶段：原始材料预处理为批量化运行脚本提供环境：

首先批量化运行并提取出测试用例为input.txt与源码处于同一文件夹下，并为了实现数据监控：代码运行时间和占用内存的获取，批量化在学生提交源码开头和结尾分别插入一段测试需要代码。从而运行时可以得到代码的运行时间和占用内存信息。至此原始材料预处理完毕

##### 第三阶段：批量化自动运行所有python文件并记录相关数据：

通过python文件批量化运行所有的学生提交的源代码，每个源代码运行完都将结果输出至同一级下的output.txt文件，包含代码本身的输出和运行时间和占用内存大小

通过python文件批量化读取运行产生的output文件并提取出程序运行时间和内存占用大小，再次通过函数，扫描程序文件得到代码行数。

至此三项数据均全部得到，结合每个文件的路径信息（拥有学生号，题目类型和题目号）生成algInitData.json进行储存等待后续数据处理

#### debug能力处理原理阐述：

需要的原始材料为样本数据json文件，评价指标为代码上传次数、第一次提交和最后一次提交分差、第一次提交和最后一次提交时间差。一般情况下，认为代码上传次数越少、前后花费时间越少即该学生对本道题debug的掌握越熟练，第一次提交和最后一次提交的分差越大即该学生对本道题debug的理解越深入，综上因素较为简单易得且逻辑分明、条理清楚，共同促成了debug能力强弱的判断。

#### 处理过程及结果：

打开原始材料样本数据json文件，记录代码上传次数、第一次提交和最后一次提交分差、第一次提交和最后一次提交时间差三项指标，通过python的批量化处理能力将得到的指标输出到一份新建的json文件下，对应目录为userId->case(caseId, caseType, upload_times, deltaScore, deltaTime)，以便后续处理。

#### 初次构建能力处理原理阐述：

需要的原始材料为样本数据json文件以及该学生该道题第一次提交代码，评价指标为第一次提交代码的时间、第一次提交代码的得分情况和第一次提交代码的代码行数。可以认为第一次提交代码的时间越早、第一次提交代码的行数越短，该学生对本道题的初次构建理解能力越强，第一次提交代码的得分越高，该学生对本道题的初次构建掌握程度越高，综上因素清晰明确、自然合理，共同促成了初次构建能力强弱的判断。

#### 处理过程及结果：

打开原始材料样本数据json文件，记录第一次提交代码的时间、第一次提交代码的得分情况两项指标，同时通过python的os包检索经过数据预处理后被下载解压序列化的py代码文件并统计得到第一次提交代码的代码行数这项指标，通过python的批量化处理能力将得到的指标输出到一份新建的json文件下，对应目录为userId->case(caseId, caseType, firstTime, firstScore, firstLines)，以便后续处理。



## 数据处理分层

#### topsis和熵权法构建题目评价模型

##### 该层次数据来源与数据目标

该层次的原始数据来源于初次处理获得的原始数据，即某位学生某道题的三项能力（debug能力，初次构建能力，算法构建能力）的各项指标，以这些评价指标为基础建立TOPSIS结合熵权法的评价模型。在经过TOPSIS结合熵权法优化后的评价模型处理之后，每名学生的每道题目都将拥有debug能力，初次构建能力，算法构建能力这三项能力的一个初步评估值。

##### TOPSIS评价模型

**1.模型概念**

TOPSIS法（Technique for Order Preference by Similarity to Ideal Solution） 可翻译为逼近理想解排序法，国内常简称为优劣解距离法 TOPSIS 法是一种常用的综合评价方法，其能充分利用原始数据的信息， 其结果能精确地反映各评价方案之间的差距。基本过程为先将原始数据矩阵统一指标类型（一般正向化处理） 得到正向化的矩阵，再对正向化的矩阵进行标准化处理以消除各指标量纲的影响，并找到有限方案中的最优方案和最劣方案，然后分别计算各评价对象与最优方案和最劣方案间的距离，获得各评价对象与最优方案的相对接近程度，以此作为评价优劣的依据。该方法对数据分布及样本含量没有严格限制，数据计算简单易行。

**2.具体算法思路**

a.指标正向化

将所有的指标转化为极大型指标，即指标正向化。

极小型指标转换为极大型指标的公式：max-x

本次数据处理中遇到的极大型指标分别为debug能力评估中的得分涨幅，初次构建能力评估中的初次得分，极小型指标是debug能力评估中的上传次数、间隔时间，初次构建能力评估中的算法构建能力评估中的初次上传时间、初次构建代码行数，算法构建能力评估中的代码行数、时间损耗和空间损耗。

数据处理首先将每道题的所有人答题情况进行汇总并整理，然后对于极小型指标依次取出最大值进行正向化并得到数据矩阵。

b.标准化处理

 为了消去不同指标量纲的影响， 需要对已经正向化的矩阵进行标准化处理。

​     标准化处理的计算公式

​     ![](https://s1.ax1x.com/2020/07/27/aiL7DS.png)

​    即每个元素除以其所在列各元素平方和的开方。

c.计算评分（结合熵权法）

根据TOPSIS评价法，此步数据处理需取各列元素的最大值，组成一个列向量Z+，取各列元素的最小值，组成一个列向量Z-，计算每列元素与最大值组成的列向量Z+的距离D+，与最小值组成的列向量Z-的距离D-，在根据评分公式：D-/(D+ + D-）为每个对象进行打分。

![](https://s1.ax1x.com/2020/07/27/aiOsGn.png)

根据上面的评分公式，为各评价对象进行打分。
此处计算评价对象与最大值、最小值距离时，利用熵权法得到的各项指标的权重代入计算，使得结果更加客观有效。

**3.模型优势**

TOPSIS法对数据分布及样本量、指标多少无严格控制，数学计算亦不复杂，其应用范围广，具有直观的几何意义；它对原始数据的利用比较充分，信息损失少。而相较于德尔菲法、层次分析法等主观赋权法，本次数据处理中用到的熵权法更具有客观性，能够更好的对结果进行解释，其利用的是信息之间的变异性（也就是差异性）来进行赋权的。因此，对TOPSIS评价的最终结果进行结合熵权法的处理使得处理结果更加客观。





#### 熵权法构建学生题目类别级别评价模型

**原理阐释：**

在确定指标权重时，往常主要是根据评价者的主观看法，人为确定权重。尽管权重是按重要性给出，但由于没有充分考虑各指标提供的信息量，人为给出的权重显然缺乏客观的科学依据，因而势必会导致对某一题过高或过低的估计，从而使得评价不能完全合理的反应学生该题目类型的真实综合评价，因此使用熵权法

在信息论中，熵是对不确定性的一种度量。信息量越大，不确定性就越小，熵也就越小；信息量越小，不确定性越大，熵也越大。不难理解，如果某个指标的信息熵越小，就表明其指标值的变异程度越大，提供的信息量越大，在综合评价中所起的作用越大，则其权重也应越大。反之，某指标的信息熵越大，就表明其指标值的变异程度越小，提供的信息量越小，在综合评价中所起的作用越小，则其权重也应越小。所以在具体分析过程中，可根据各个指标值的变异程度，利用熵来计算出各指标权重，再对所有指标进行加权，从而得出较为客观的综合评价结果。

主要通过熵权法来获得一类题（不同指标评分单独）下的各个题目的权重，从而将对题目的三项评价整合提升为该题目类型的三项评价。

**处理过程：**

1.设立综合评价指标矩阵：

横坐标（表头）为评价的目标学生一类题所做的所有题号，表内数据每一列填充该题号对应系统中的所有记录（对应的指标：算法构建评价|debug评价|第一次构建评价）评价值。消除残缺行，从而构建出学生一类题具体指标的评价矩阵

2.指标（一类题下的题目）的归一化处理：异质指标同质化

​		由于各项指标的计量单位并不统一，因此在用它们计算综合指标前，先要对它们进行标准化处理，即把指标的绝对值转化为相对值，并令![img](http://latex.codecogs.com/gif.latex?x_%7Bij%7D=%7Cx_%7Bij%7D%7C)，从而解决各项不同质指标值的同质化问题。其具体方法如下:



![](https://s1.ax1x.com/2020/07/27/aiXPQP.gif)

3.利用熵权法确定权重:

-  1.计算Pij（第j项指标下第i个具体指标评价值的 比重）：

![](https://s1.ax1x.com/2020/07/27/aiz3cR.png)

- 2.计算第j项指标的熵值：

![](https://s1.ax1x.com/2020/07/27/aixbfH.png)

​		其中，K=1/Ln（n）	

- 3.计算第j项指标的差异系数：
  ![g_{j}=1-e_{j}](https://private.codecogs.com/gif.latex?g_%7Bj%7D%3D1-e_%7Bj%7D)

- 4.计算第j项指标的权重

![](https://s1.ax1x.com/2020/07/27/aiz2E8.gif)

4.计算学生评价指标下题目类型的综合得分：

![](https://s1.ax1x.com/2020/07/27/aFSk5D.png)

#### RSR学生三项能力评价模型

#### 1.该层次数据来源与数据目标

该层次的原始数据来源于熵权法构建的学生各类别题目三项能力评价模型，在经过RSR模型处理之后，每名学生的8*3个能力数据将综合为每名学生的debug能力，第一次构建代码能力，算法构建能力这三项能力的RSR矫正值，我们最后将获得所有学生这三项能力的RSR矫正值的排行表。

#### 2.RSR评价模型

##### 1）.模型概念

秩和比法（即RSR评价模型，Rank-sum ratio）是一种将古典参数统计和近代非参数统计相结合，并融其各自优点于一身的统计分析方法，于1988年由我国的田风调教授提出，该模型适合对行列表格的资料进行综合评价，也可应用于分类及计量资料的综合评价，其基本思想为将一个 n 行（n 评价对象）p 列（p 个评价指标）矩阵通过秩转换，获得无量纲的统计量RSR，以RSR值对评价对象的优劣进行排序或分档排序。

##### 2）.具体算法思路

a.获得原始数据表

在使用RSR综合评价模型时，会根据评价目的，选择适合的评价指标，评价指标中有高优指标（即效益型指标，相当于TOPSIS模型中的极大型指标），低优指标（即成本型指标，相当于TOPSIS模型中的极小型指标）以及不分高优低优的指标。在我们的学生三项能力评价模型中，所有的评价指标都是经过上层数据处理得到的用积分评判的指标，因此均为高优指标。

在学生三项能力评价模型中，原始数据表为3个n*6的矩阵，其中n为user数即学生数量，6指的是学生在六类题型中某一种能力的评分，共有三项能力，故而有三个这样的矩阵。

b.对原始数据编秩

编秩是指对每个评价指标的值进行排序，得到一个秩次R，用得到的秩次R来代替原来的指标值，从而建立新的秩次数据矩阵。对于高优指标而言，指标值越高，秩越大。

编秩的方法有两种，分别为整秩法和非整秩法，在这里我们采用的是比较常用的整秩法。即高优指标从小到大编秩，低优指标从大到小编秩，同一指标数据相同者取平均值。

c.计算秩和比RSR值

<img src="https://s1.ax1x.com/2020/07/20/U4eout.png" style="zoom: 67%;" />

在这里，我们计算RSR值运用的是第一个公式，计算完成后，按RSR值对评价对象的优劣进行直接排序。

d.确定RSR分布

RSR 的分布是指用概率单位Probit表达的值特定的累计频率 .Probit模型是一种广义的线性模型，服从正态分布。具体步骤如下：

s1.将每个对象的RSR值按照升序排列

s2.编制RSR频数分布表，列出各组频数和各组累积频数

s3.对各组的RSR进行编秩算出秩次并算出平均秩次

s4.列出累计频率*R*ˉ/n ×100%，最后一项用（1-1/4n）×100%进行修正

s5.将上一步得到的累积频率转换为概率单位Probit

例：![](https://s1.ax1x.com/2020/07/21/UoTul9.png)

e.计算直线回归方程

以概率单位值Probit 为自变量，以RSR值为因变量，计算回归方程：

RSR=a+b×Probit

在回归方程检验中，我们着重回归方程的拟合度检验，在本例中，方程的拟合度为97.1%。

<img src="https://s1.ax1x.com/2020/07/20/U4Q4gg.png" style="zoom:80%;" />

f.根据计算出的回归方程计算出RSR的矫正值，并按降序排序。

例：<img src="https://s1.ax1x.com/2020/07/20/U4lrGT.png" style="zoom: 80%;" />

##### 3）.模型优缺点

优点：运用数据的相对大小代替数据真实值，可以减小异常值，离群数据的干扰，同时显示数据间的微小差异，该方法综合能力强，可以作为一个专门的综合指标来进行统计分析。此外，该方法以非参数法为基础，不引入主观变量，对指标的选择无特殊性要求，适用性很强。

缺点：最终排序的依据是对原始数据进行编秩后的秩次矩阵而并非原始数据本身，获得的RSR值也只能体现出综合秩次的差距，这就难以避免地会丢失掉一部分原始信息，从而导致对信息的利用不完全。